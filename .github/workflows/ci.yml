name: CI

on:
  push:
    branches:
      - main
      - master
    tags:
      - 'v*.*.*'
  pull_request:
    branches:
      - main
      - master
  workflow_dispatch:
    inputs:
      push:
        description: 'push the Docker image to the registry'
        type: boolean
        required: false
        default: false

permissions:
  contents: read
  packages: write

jobs:
  ci:
    name: CI
    uses: richardmsong/shared-workflows/.github/workflows/ci.yml@main
    with:
      go-version-file: 'go.mod'
      push-image: true
      run-tests: true
      run-lint: true
      lint-version: 'v2.7.2'
      docker-build-target: 'docker-buildx-ci'
    secrets:
      CLAUDE_APP_ID: ${{ secrets.CLAUDE_APP_ID }}
      CLAUDE_APP_PRIVATE_KEY: ${{ secrets.CLAUDE_APP_PRIVATE_KEY }}
